<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script type="text/javascript" src="scripts%2Fjquery-1.12.3.min.js"> </script>
<script type="text/javascript" src="scripts%2Fjquery-rotate.min.js"> </script>

<script type="text/javascript"> 
var delay=0.5;
var Mutex = 0;

var SERVER="www.gizmo-hub.com";
var PORT="9998";
var REST_DEVICE_URL = "http://" + SERVER + ":" + PORT + "/cp/owner/ANONYMOUS/device/N%2FA/";

var REST_MJPG_STREAM="lastImage";
var REST_SEND_COMMAND="sendCommand";

var MJPG_URL= REST_DEVICE_URL + REST_MJPG_STREAM;
var SENDCOMMAND_URL = REST_DEVICE_URL + REST_SEND_COMMAND;

var REFRESH_MILLIS = 300;
var STOP=0;

var STREAMING_COMMAND_TYPE = 4;
var STREAMING_COMMAND = 5;

var timeoutID = 0;
function load_jpeg()
{
	REFRESH_MILLIS = document.getElementById("refresh").value;
    if(Mutex == 0)
    {
    	Mutex = 1;
		var time = (new Date()).getTime();
        document.getElementById("stream").src = MJPG_URL+"?_=" + time;
        setTimeout('load_jpeg()',REFRESH_MILLIS);
        Mutex = 0;
    }
}

//setTimeout('load_jpeg()',REFRESH_MILLIS);

function startStreaming() {
	Mutex = 0;
	timeoutID = setTimeout('load_jpeg()',REFRESH_MILLIS);
	sendCommand(STREAMING_COMMAND_TYPE, STREAMING_COMMAND);
}

function stopStreaming() {
	Mutex = 1;
	clearTimeout(timeoutID);
	sendCommand(STREAMING_COMMAND_TYPE, STOP);
}

function sendCommand(type, cmd) {
	$.ajax({
		  	url: SENDCOMMAND_URL + "?_="+new Date().getTime()+"&type="+type+"&cmd="+cmd,
			method: "POST"
	});
}

function applyRotate() {
	$("#stream").rotate(parseInt(document.getElementById("rotate").value));
}
</script> 
</head> 
<body>
	<img id="stream" src="" /> 
	
	<div style="margin-top: 15px">
		<button onclick="startStreaming()">Start Streaming</button> <button onclick="stopStreaming()">Stop Streaming</button>
	</div>
	<br /><br /><br /><br />
	
	Refresh in millis: <input id="refresh" value="300" />
	<br />
	Rotate: <input id="rotate" value="90" /> <button onclick="applyRotate()">Apply</button>
	
	<br /><br />
	<div id="bt-controls" style="padding: 8px; max-width: 480px;">
	
		<button style="float: left; margin-right: 1%; margin-bottom: 2%; width: 39%; height: 32px; border: 1px solid green"
		 onmousedown="sendCommand(1,1)" onmouseup="sendCommand(1,0)">FWD</button>
		<button style="float: left; margin-left: 1%; margin-bottom: 2%; width: 39%; height: 32px; border: 1px solid green"
		 onmousedown="sendCommand(1,2)" onmouseup="sendCommand(1,0)">BACK</button>
		
		<br style="clear: both" />
		
		<button style="float: left; margin-right: 1%; margin-top: 2%; width: 39%; height: 32px; border: 1px solid red"
		 onmousedown="sendCommand(1,3)" onmouseup="sendCommand(1,0)">LEFT</button>
		<button style="float: left; margin-left: 1%; margin-top: 2%; width: 39%; height: 32px; border: 1px solid red"
		 onmousedown="sendCommand(1,4)" onmouseup="sendCommand(1,0)">RIGHT</button>
		
		<br style="clear: both" />
		
		<button style="margin-top: 2%; width: 80%; height: 80px; border: 1px solid red"  onmousedown="sendCommand(1,0)">STOP</button>
		
	</div>
	
	<script type="text/javascript">
		applyRotate();
	</script>
</html>
